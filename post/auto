#!/bin/zsh
set -eu; base=${0:a:h}/..; source $base/common; cd_info

print "* auto script started"

# check not already done
print; print "* notarizing"
if load_info notarized; then
  print "already sent for notarization"
else
  $base/post/notarize -q
  display "Sent for notarization ‚è±" "Auto publish"
fi

print; print "* stapling"
if load_info stapled; then
  print "already stapled"
else
  $base/post/staple
fi

print; print "* verifying"
if load_info verified; then
  print "already verified"
else
  $base/post/verify -q
fi

if [[ $edition == $edition_sa ]]; then
print; print "* publishing"
if load_info published; then
  print "already published"
else
  $base/post/publish
  display "Finished üéâ" "Auto publish"
fi
else
print; print "* not publishing because not standalone edition"
fi

